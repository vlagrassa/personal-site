{% extends 'base-center.html' %}


{% block head %}
<script src="https://unpkg.com/github-calendar@2.3.2/dist/github-calendar.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/github-calendar@2.3.2/dist/github-calendar-responsive.css"/>
<link rel="stylesheet" href="{{ url_for('static', filename='styles/github-calendar.css') }}">
{% endblock %}


{% block style %}
<style>
  @keyframes blink {
    from {
      border-color: white;
    }
    to {
      border-color: transparent;
    }
  }
  #blinker {
    border-left: 2px solid white;
  }
  #blinker.blinker {
    animation-name: blink;
    animation-duration: 0.5s;
    animation-direction: alternate;
    animation-iteration-count: infinite;

  }
</style>
{% endblock %}


{% block title_inline %}
<div style="font-size: 1.25em">{{ super() }}</div>
{% endblock %}


{% block header_image %}
  <div class="row h-100">
    <div class="col-12 col-md-8 d-flex align-items-center justify-content-center">
      <div class="header-image-overlay d-flex flex-column align-items-center justify-content-center text-center">

        {% block header %}
          {{ super() }}
          <div class="header-underbar">&#x2B26;</div>
        {% endblock %}

        <div class="mx-5 fs-5">
          {% include '_includes/blurb.html' %}
          <p style="height: 2.5em; overflow-y: visible; margin-bottom: -0.0em;">Often described <span id="third-point"></span><span id="blinker"></span></p>
        </div>

        <div style="width: 92%">
          <svg class="desc-button" tabindex="0" viewBox="0 0 10 10" width="18px" height="18px">
            {% include '_includes/svg.html' %}
            <circle cx="5" cy="5" r="5" class="desc-button-bg-overlay" mask="url(#svg-mask-info)" />
          </svg>
          <svg class="desc-button" tabindex="0" viewBox="0 0 10 10" width="18px" height="18px" onclick="toggle_play()">
            <circle id="play-btn" cx="5" cy="5" r="5" class="desc-button-bg-overlay" mask="url(#svg-mask-pause)" />
          </svg>
        </div>
      </div>
    </div>
    <div class="d-none d-md-block col-4"></div>
  </div>
{% endblock %}


{% block sections %}
  {% from '_macros/utils.j2' import render_contents_entry %}
  {{ render_contents_entry('welcome',  { 'en': "Welcome!",              'tj': "Welcome!",        'ja': 'ようこそ！' }) }}
  {{ render_contents_entry('timeline', { 'en': "Timeline",              'tj': "Timeline",        'ja': 'タイムライン' }) }}
  {{ render_contents_entry('timeline-present',   { 'en': "2022 - Present", 'tj': '2022 - Present', 'ja': '2022 - 今' }, sub=true) }}
  {{ render_contents_entry('timeline-2018-2022', { 'en': "2018 - 2022",    'tj': '2018 - 2022',    'ja': '2018 - 2022' }, sub=true) }}
  {{ render_contents_entry('timeline-earlier',   { 'en': "2018 & Earlier", 'tj': '2018 & Earlier', 'ja': '2018 & その前' }, sub=true) }}
  {{ render_contents_entry('activity', { 'en': "Activity",              'tj': "Activity",        'ja': '活動' }) }}
  {{ render_contents_entry('another',  { 'en': "Another Section",       'tj': "Another Section", 'ja': '別の部分' }) }}
  {{ render_contents_entry('contact',  { 'en': "Let's Connect!",        'tj': "Let's Connect!",  'ja': '連絡しよう' }) }}
{% endblock %}


{% block right_panel_top %}
  <div class="d-flex flex-column gap-3 py-3">
    <h6 class="pb-0 mb-0">
      <span {{set_lang('en')}}>Quick Links</span>
      <span {{set_lang('ja')}}>リンク</span>
      <span {{set_lang('tj')}}>Quick Links</span>
    </h6>
    <div class="panel p-2">
      Résumé
    </div>
    <div class="panel p-2">
      Experience
    </div>
    <div class="panel p-2">
      Contact
    </div>
  </div>
{% endblock %}


{% block content %}
<div id="welcome">
  <h3 class="pt-3">
    <span {{set_lang('en')}}>Welcome!</span>
    <span {{set_lang('ja')}}>ようこそ！</span>
    <span {{set_lang('tj')}}>Welcome!</span>
  </h3>
  <p class="text-body-secondary fst-italic">
    Hello there
  </p>
  {% include '_includes/lorem-ipsum.html' %}
</div>

<div id="timeline">
  <h3 class="pt-3">
    <span {{set_lang('en')}}>Timeline</span>
    <span {{set_lang('ja')}}>タイムライン</span>
    <span {{set_lang('tj')}}>Timeline</span>
  </h3>
  {% include '_includes/timeline.html' %}
</div>

<div id="activity">
  <h3 class="pt-3">
    <span {{set_lang('en')}}>Activity</span>
    <span {{set_lang('ja')}}>活動</span>
    <span {{set_lang('tj')}}>Activity</span>
  </h3>
  <p>
    I'm usually pretty active on GitHub:
  </p>
  <div id="calendar" class="calendar">
    <div class="mb-4">
      <div class="spinner-border" style="width: 2rem; height: 2rem; color: var(--color-primary-4);" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  </div>
  <p>
    To see what sort of projects I'm working on,
    check out my <a class="link" href="github.com">GitHub profile</a> or this site's <a class="link" href="{{ url_for('projects.projects') }}">Projects</a> page.
  </p>
</div>

<div id="another">
  <h3 class="pt-3">
    <span {{set_lang('en')}}>Another Section</span>
    <span {{set_lang('ja')}}>別の部分</span>
    <span {{set_lang('tj')}}>Another Section</span>
  </h3>
  {% include '_includes/lorem-ipsum.html' %}
  <div class="panel px-4 py-4 mt-2 mb-3">
    Hello!
  </div>
  {% include '_includes/lorem-ipsum.html' %}
  {% include '_includes/lorem-ipsum.html' %}
</div>


<h3 id="contact" class="pt-3">
  <span {{set_lang('en')}}>Let's Connect!</span>
  <span {{set_lang('ja')}}>連絡しよう</span>
  <span {{set_lang('tj')}}>Let's Connect!</span>
</h3>
<p>
  If you've got questions, comments, or just want to say hi, feel free to reach out at <a class="link" href="mailto:contact@vlagrassa.dev">contact@vlagrassa.dev</a>.
</p>
<p>
  I'd love to hear from you!
</p>
{% endblock %}


{% block script %}
<script>
  {% include '_scripts/phrase-manager.js' %}

  const target  = document.getElementById('third-point');
  const blinker = document.getElementById('blinker');

  var play = true;

  fetch("{{url_for('home.get_descriptors')}}").then((foo) => foo.json()).then(async (descriptors) => {
    phraseManager.init(
      target,
      descriptors,
      () => play,
      (typing_status) => blinker.classList.toggle('blinker', !typing_status),
    );
  })

  function toggle_play() {
    play = !play;
    document.getElementById('play-btn').setAttribute('mask', `url(#svg-mask-${play ? 'pause' : 'play'})`);
    target.dispatchEvent(new CustomEvent('play', {
      detail: {play}
    }));
  }
</script>

<script>
  const day_els = [
    {%- for d in DAYS %}
    '{{render_lang_object(d)}}',
    {%- endfor %}
  ];
  const month_els = [
    {%- for m in MONTHS %}
    '{{render_lang_object(m)}}',
    {%- endfor %}
  ];

  GitHubCalendar(".calendar", "vlagrassa").then(() => {

    // Make calendar day labels change with language selection
    get_day_label(1).children[1].innerHTML = day_els[1];
    get_day_label(3).children[1].innerHTML = day_els[3];
    get_day_label(5).children[1].innerHTML = day_els[5];

    // Make calendar month labels change with language selection
    const month_labels = get_month_labels();
    if (month_labels) {
      month_labels.forEach((a, i) => {
        a.children[1].innerHTML = month_els[i];
      });
    }

    const legend = document.getElementById('calendar').querySelector('.js-calendar-graph').children[1].children[1];
    legend.style.display = 'flex';
    legend.style.alignItems = 'center';
    legend.style.gap = '3px';
    legend.style.marginTop = '3px';
    legend.innerHTML = legend.innerHTML.replace('Less', '<small style="padding-right: 3px;">{{render_lang_object({"en": "Less", "tj": "Less", "ja": "小"})}}</small>');
    legend.innerHTML = legend.innerHTML.replace('More', '<small style="padding-left:  3px;">{{render_lang_object({"en": "More", "tj": "More", "ja": "大"})}}</small>');
  });

  function get_day_label(i) {
    return document.getElementById('calendar').querySelector('tbody').children[i].children[0];
  }

  function get_month_labels() {
    const arr = Array.from(document.getElementById('calendar').querySelector('thead').children[0].children).slice(1);
    for (let i = 0; i < arr.length; i++) {
      if (arr[i].children[1].innerText === "Jan") {
        return arr.slice(i).concat(arr.slice(0, i));
      }
    }
  }
</script>
{% endblock %}
