{% extends 'base-sidepanel.html' %}

{% block head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='blog.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='buttons.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='search.css') }}">
{% endblock %}


{% block leftpanel %}
{% from '_includes/lang.j2' import render_searchbar %}

<form style="width: 90%; margin: auto;">
  {{ render_searchbar(
    id='search-text', oninput='search_text',
    label={'en': 'Title', 'ja': '題名', 'tj': 'Title'},
    ) }}
  {{ render_searchbar(
    id='search-tags',
    label={'en': 'Tags', 'ja': 'タグ', 'tj': 'Tags'},
  ) }}
  <div style="display: flex; justify-content: space-between; margin-top: -10px;">
    <div style="flex: 1">
      {{ render_searchbar(
        id='search-date-1',
        label={'en': 'Start Date', 'ja': '開始日', 'tj': 'Start Date'},
      ) }}
    </div>
    <div style="width: 8px"></div>
    <div style="flex: 1">
      {{ render_searchbar(
        id='search-date-2',
        label={'en': 'End Date', 'ja': '終了日', 'tj': 'End Date'},
      ) }}
    </div>
  </div>
</form>
{% endblock %}


{% block content %}
{% from '_includes/blog-post-card.j2' import render_blog_card with context %}
<div class="blog-container">
  {% for post in posts %}
    {{ render_blog_card(post) }}
  {% endfor %}
</div>
{% endblock %}


{% block script %}
<script>
  const post_list = {
    {%- for post in posts %}
    "card-{{post.id}}": {
      "title": "{{post.title}}",
      "tags": [ {% for tag in post.tags %}"{{tag.id}}",{% endfor %} ],
    },
    {%- endfor %}
  }

  function search_text(val) {
    val = val.toLowerCase();
    for (let key in post_list) {
      document.getElementById(key).style.display = post_list[key]['title'].toLowerCase().includes(val) ? 'inline-flex' : 'none';
    }
  }

  function select_tag(tag) {
    if (tag) {
      for (let key in post_list) {
        document.getElementById(key).style.display = post_list[key]['tags'].includes(tag) ? 'inline-flex' : 'none';
      }
    }
    else {
      for (let key in post_list) {
        document.getElementById(key).style.display = 'inline-flex';
      }
    }
  }
</script>
{% endblock %}
