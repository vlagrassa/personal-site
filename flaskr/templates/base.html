{% from '_includes/lang.j2'   import render_lang_select_button, set_lang with context %}
{% from '_includes/header.j2' import render_logo, render_sections, render_links, render_footer_button, render_footer_button_menu, render_footer_button_toggle with context %}
<!doctype html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}{{title[lang]}}{% endblock %} &#x2B26; vlagrassa</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='buttons.css') }}">
  {%- block head %}{% endblock -%}
</head>

{% block style %}{% endblock %}

<body>

  <!-- Header Nav -->
  <div id="header" class="navbar">
    <div class="header-left">
      {{ render_logo(hover="title_hover") }}
    </div>
    <nav class="header-middle">
      {{ render_sections(nav_sections) }} {# sep="&#11041;" #}
    </nav>
    <div class="header-right" style="width: {{ nav_links|length * 38 }}px;">
      {{ render_links(nav_links, 38, 60) }}
    </div>
  </div>
  <!-- /Header Nav -->

  <!-- Main Body -->
  {% set main_scroll = 'scroll' if bigimage else 'hidden' %}
  <div class="overflow-y-{{ main_scroll }} overflow-x-hidden w-100 flex-grow-1">

    {% if bigimage %}
    <section class="position-relative h-100">
      {% block bigimage %}{% endblock %}
    </section>
    {% endif %}

    <div class="overflow-hidden {% if not bigimage %}h-100{% endif %}">
      {% for message in get_flashed_messages() %}
        <div class="flash">{{ message }}</div>
      {% endfor %}

      {% block body %}{% endblock %}
    </div>
  </div>
  <!-- /Main Body -->

  <div id="footer" class="footer-h">

    <!-- Language Selector -->
    {% call render_footer_button_menu('language', { 'en': "Language", 'ja': '言語', 'tj': 'Tʒoga' }, "select-language") %}
      <div class="offcanvas-body px-0 pt-0">
        {%- for l in langs %}
        {{ render_lang_select_button(l) }}
        {%- endfor %}
      </div>
    {% endcall %}
    <!-- /Language Selector -->

    <!-- Light & Dark Mode Selector -->
    {{ render_footer_button_toggle(
      ('dark_mode',  { 'en': "Dark Mode",  'ja': '夜', 'tj': 'Dark Mode'  }, 'hover-rotate-90-m'),
      ('light_mode', { 'en': "Light Mode", 'ja': '日', 'tj': 'Light Mode' }, 'hover-rotate-45'),
    ) }}
    <!-- /Light & Dark Mode Selector -->

    <!-- Layout Selector -->
    {{ render_footer_button_toggle(
      (('grid_view',  'dashboard'),  { 'en': "Simple Layout",  'ja': '簡単な形式', 'tj': 'Simple Layout'  }),
      (('view_quilt', 'view_comfy'), { 'en': "Complex Layout", 'ja': '複雑な形式', 'tj': 'Complex Layout' }),
    ) }}
    <!-- /Layout Selector -->

    <!-- Zoom Selector -->
    {% call render_footer_button_menu(('zoom_in', 'add_circle'), { 'en': "Zoom", 'ja': 'ズーム', 'tj': 'Zoom' }, "select-zoom-level") %}
      <div class="offcanvas-body pt-0">
        <div class="slidecontainer">
          <input type="range" min="1" max="5" value="3" class="slider">
        </div>
      </div>
    {% endcall %}
    <!-- /Zoom Selector -->

    {{ render_footer_button('settings',   { 'en': "Settings", 'ja': '設定', 'tj': 'Settings' }, 'hover-rotate-60') }}
  </div>

</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>

<script>
  const LANGS = [{% for l in langs %}'{{l.code}}', {% endfor %}];

  function title_hover(el, val) {
    if (val) {
      // TODO: hover
    } else {
      // TODO: no hover
    }
  }

  function set_language(val) {
    LANGS.forEach((lang_code) => {
      document.getElementById(`button-${lang_code}`).classList.toggle('selected', val === lang_code)
      document.querySelectorAll(`[data-lang="${lang_code}"]`).forEach((el) => {
        el.classList.toggle('hide', val !== lang_code)
      })
    })
    {% if title %}
    {%- for l, t in title.items() %}
    if (val === "{{l}}") document.title = "{{t}} {% if l != 'en' %}({{title.en}}) {% endif %}⬦ vlagrassa";
    {%- endfor %}
    {%- endif %}

    document.dispatchEvent(new CustomEvent('set-language', {
      'detail': { 'language': val },
    }));
  }
  set_language("{{lang}}")


  // Enable tooltips
  const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
  const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))

</script>

{% block script %}{% endblock %}