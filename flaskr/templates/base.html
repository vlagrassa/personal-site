<!doctype html>
<title>{% block title %}{{title[lang]}}{% endblock %} &#x2B26; vlagrassa</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<div id="nav">
  <div id="nav-inner">
    <div style="margin-left: 20px;">
      <h1 class="my-logo" onmouseenter="title_hover(this, true)" onmouseleave="title_hover(this, false)">vlagrassa</h1>
    </div>
    <div style="display: flex; align-items: center;">
      {% for section in nav_sections %}
      {% if loop.index0 > 0 %}
      <div class="header-separator">&#x2B26;</div>
      {% endif %}
      <div class="header-button">
        <a {% if section.link %}href="{{section.link}}"{% endif %}>
          {% for l, t in section.title.items() %}<span lang="{{l}}" data-lang="{{l}}">{{t}}</span>{% endfor %}
        </a>
        <div class="header-button-underline"></div>
      </div>
      {% endfor %}
    </div>
    <nav style="display: flex; align-items: center; justify-content: center; margin-right: 20px; width: {{ nav_links|length * 40 }}px;">
      {% for link in nav_links %}
        <a href="{{ link.url }}" class="slice" style="background-color: {{link.color}};" onmouseenter="openicon(this)" onmouseleave="closeicon(this)">
          <img title="{{link.title}}" height="36px" width="40px" style="object-fit: contain;" src="{{ url_for('static', filename='logos/' + link.path + '/logo-dark.png') }}">
        </a>
      {% endfor %}
    </nav>
  </div>
</div>
<section class="content">
  {% for message in get_flashed_messages() %}
    <div class="flash">{{ message }}</div>
  {% endfor %}

  <header>
    {% block header %}
    {% if title and not hide_title %}
      <div style="text-align: center;">
        <h2>
          {% for l, t in title.items() %}
            <span lang="{{l}}" data-lang="{{l}}">{{t}}</span>
          {% endfor %}
        </h2>
      </div>
    {% endif %}
    {% endblock %}
  </header>

  <div style="margin: 0px 30px; background-color: white; border-radius: 8px; display: flex;">
    <div style="flex: 1; display: flex; flex-direction: column;">
      {% for l in langs %}
      <button id="button-{{l.code}}" lang="{{l.code}}" onclick="set_language('{{l.code}}')">{{l.name}}</button>
      {% endfor %}
    </div>
    <div style="flex: 5">
      {% block content %}{% endblock %}
    </div>
  </div>
</section>
<script>
  const LANGS = [{% for l in langs %}'{{l.code}}', {% endfor %}];

  const closed_width = 40;
  const open_width = 60;

  function openicon(iconEl) {
    iconEl.style.setProperty('--w', open_width + 'px');
    const icons = Array.from(document.getElementsByClassName('slice'));
    const total_width = icons.length * closed_width;
    const target_width = (total_width - open_width) / (icons.length - 1);
    icons.forEach(element => {
      if (element != iconEl) {
        element.style.setProperty('--w', target_width + 'px');
      }
    });
  }

  function closeicon(iconEl) {
    const icons = Array.from(document.getElementsByClassName('slice'));
    icons.forEach(element => {
      element.style.setProperty('--w', '40px');
    });
  }

  function title_hover(el, val) {
    if (val) {
      // TODO: hover
    } else {
      // TODO: no hover
    }
  }

  function set_language(val) {
    LANGS.forEach((lang_code) => {
      document.getElementById(`button-${lang_code}`).classList.toggle('active', val === lang_code)
      document.querySelectorAll(`[data-lang="${lang_code}"]`).forEach((el) => {
        el.classList.toggle('hide', val !== lang_code)
      })
    })
    {% if title %}
    {% for l, t in title.items() %}
    if (val === "{{l}}") document.title = "{{t}} {% if l != 'en' %}({{title.en}}) {% endif %}â¬¦ vlagrassa";
    {% endfor %}
    {% endif %}
  }
  set_language("{{lang}}")
</script>